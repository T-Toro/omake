<!DOTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>おまけ</title>
<script src="https://code.jquery.com/jquery-3.3.1.js"
integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<script>
var pages = $('.pages').children();
var grabs = false; // Gonna work on this, one day

pages.each(function(i) {
 var page = $(this);
 if (i % 2 === 0) {
 page.css('z-index', (pages.length - i)); 
 }
});

$(window).load(function() {
 
 $('.page').click(function() {
 var page = $(this);
 var page_num = pages.index(page) + 1;
 if (page_num % 2 === 0) {
 page.removeClass('flipped');
 page.prev().removeClass('flipped');
 } else {
 page.addClass('flipped');
 page.next().addClass('flipped');
 }
 });

 if (grabs) {
 $('.page').on('mousedown', function(e) {
 var page = $(this);
 var page_num = pages.index(page) + 1;
 var page_w = page.outerWidth();
 var page_l = page.offset().left;
 var grabbed = '';
 var mouseX = e.pageX;
 if (page_num % 2 === 0) {
 grabbed = 'verso';
 var other_page = page.prev();
 var centerX = (page_l + page_w);
 } else {
 grabbed = 'recto';
 var other_page = page.next();
 var centerX = page_l;
 }

 var leaf = page.add(other_page);

 var from_spine = mouseX - centerX;

 if (grabbed === 'recto') {
 var deg = (90 * -(1 - (from_spine/page_w)));
 page.css('transform', 'rotateY(' + deg + 'deg)');

 } else {
 var deg = (90 * (1 + (from_spine/page_w)));
 page.css('transform', 'rotateY(' + deg + 'deg)');
 }

 leaf.addClass('grabbing');

 $(window).on('mousemove', function(e) {
 mouseX = e.pageX;
 if (grabbed === 'recto') {
 centerX = page_l;
 from_spine = mouseX - centerX;
 var deg = (90 * -(1 - (from_spine/page_w)));
 page.css('transform', 'rotateY(' + deg + 'deg)');
 other_page.css('transform', 'rotateY(' + (180 + deg) + 'deg)');
 } else {
 centerX = (page_l + page_w);
 from_spine = mouseX - centerX;
 var deg = (90 * (1 + (from_spine/page_w)));
 page.css('transform', 'rotateY(' + deg + 'deg)');
 other_page.css('transform', 'rotateY(' + (deg - 180) + 'deg)');
 }

 console.log(deg, (180 + deg) );
 });


 $(window).on('mouseup', function(e) {
 leaf
 .removeClass('grabbing')
 .css('transform', '');

 $(window).off('mousemove');
 });
 });
 }
 
 $('.book').addClass('bound');
});
</script>
<body>
<div class="book bound">
 <div class="pages">
 <div class="page">
 <h1>Boyhood</h1>
 <h2>by Jason Hibbs</h2>
 </div>
 <div class="page"><!--endpaper--></div>
 <div class="page"><!--endpaper--></div>
 <div class="page"><!--colophon--></div>
 <div class="page"><!--title--></div>
 <div class="page"><!--01--></div>
 <div class="page">There was a boy<br>Who had it rough</div>
 <div class="page">His adventure<br>Was to be tough</div>
 <div class="page"><!--04--></div>
 <div class="page"><!--05--></div>
 <div class="page">He knew his Mother<br>Had left this land</div>
 <div class="page">He knew his Father<br>Like the back of his hand</div>
 <div class="page"><!--08--></div>
 <div class="page">There were monsters<br>He had to fight</div>
 <div class="page"><!--10--></div>
 <div class="page"><!--11--></div>
 <div class="page">He sometimes hid<br>He never cried</div>
 <div class="page">There was a boy<br>Who was afraid</div>
 <div class="page">Who wore armour<br>That he had made</div>
 <div class="page"><!--15--></div>
 <div class="page">There was a boy<br>Who met a girl</div>
 <div class="page"><!--17--></div>
 <div class="page">He met a girl<br>Who changed his world</div>
 <div class="page"><!--19--></div>
 <div class="page">Who saw the armour<br>And looked inside</div>
 <div class="page">And inside…</div>
 <div class="page"><!--22--></div>
 <div class="page">There was a boy.</div>
 <div class="page"><!--24--></div>
 <div class="page"><!--endpaper--></div>
 <div class="page"><!--endpaper--></div>
 <div class="page"><!--backcover--></div>
 </div>
</div>
</body>
  </head>
</html>
